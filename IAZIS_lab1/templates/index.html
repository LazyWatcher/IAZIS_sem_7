<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Boolean Search System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç AI Boolean Search System</h1>
            <p>–õ–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å AI-–∞–Ω–∞–ª–∏–∑–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
        </header>

        <nav class="tabs">
            <a href="/" class="tab active">–ü–æ–∏—Å–∫</a>
            <a href="/evaluation" class="tab">–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞</a>
        </nav>

        <main>
            <!-- –°–µ–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ø–∞–ø–∫–∏ (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è) -->
            <div class="folder-section">
                <h3>üìÅ –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</h3>
                <div class="folder-input-container">
                    <div class="path-input-group">
                        <input type="text" id="folderPath"
                               placeholder="C:\Users\–ò–º—è\Documents\... –∏–ª–∏ /home/user/documents/..."
                               class="path-input">
                        <button id="browseBtn" class="browse-btn">–û–±–∑–æ—Ä...</button>
                    </div>
                    <button id="processFolderBtn" class="process-folder-btn">
                        üìÇ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É
                    </button>
                </div>

                <div class="folder-options">
                    <label>
                        <input type="checkbox" id="recursiveScan" checked>
                        –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥ –ø–æ–¥–ø–∞–ø–æ–∫
                    </label>
                    <label>
                        <input type="checkbox" id="includePdf" checked>
                        –í–∫–ª—é—á–∞—Ç—å PDF —Ñ–∞–π–ª—ã
                    </label>
                </div>

                <div id="folderInfo" class="folder-info hidden">
                    <div class="folder-stats">
                        <p>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–ø–∫–∏:</p>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:</span>
                                <span class="stat-value" id="totalFiles">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ:</span>
                                <span class="stat-value" id="processedFiles">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">–¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤:</span>
                                <span class="stat-value" id="fileTypes">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="folderMessage" class="folder-message hidden"></div>
            </div>

            <!-- AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
            <div class="ai-recommendations hidden" id="aiRecommendations">
                <h3>ü§ñ AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞</h3>
                <p class="ai-description">–ò–ò –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø–∞–ø–∫–µ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã:</p>
                <div class="ai-queries" id="aiQueries">
                    <!-- AI –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∫–Ω–æ–ø–∫–∏ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ -->
                </div>
                <div class="ai-loading hidden" id="aiLoading">
                    <div class="spinner"></div>
                    <p>AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è</p>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ -->
            <div class="search-section">
                <form action="/search" method="POST" class="search-form">
                    <div class="search-box">
                        <input type="text" name="query" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º..."
                               value="{{ request.form.get('query', '') }}" required
                               id="searchQuery">
                        <button type="submit" id="searchBtn">–ù–∞–π—Ç–∏</button>
                    </div>
                    <div class="search-options">
                        <div class="operator-select">
                            <label class="operator-option">
                                <input type="radio" name="operator" value="AND" checked>
                                <span class="operator-label">AND (–≤—Å–µ —Å–ª–æ–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ)</span>
                            </label>
                            <label class="operator-option">
                                <input type="radio" name="operator" value="OR">
                                <span class="operator-label">OR (—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ)</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>

            {% if error %}
            <div class="error-message">
                –û—à–∏–±–∫–∞: {{ error }}
            </div>
            {% endif %}

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
            <div class="system-info">
                <h4>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ:</h4>
                <p>–ó–∞–≥—Ä—É–∂–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: <span id="docCount">0</span></p>
                <p>–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–æ —Ç–µ—Ä–º–∏–Ω–æ–≤: <span id="indexTerms">0</span></p>
                <p>–¢–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞: <span id="currentFolder">–ù–µ –≤—ã–±—Ä–∞–Ω–∞</span></p>
                <p>–¢–∏–ø –ø–æ–∏—Å–∫–∞: <strong>–ë—É–ª–µ–≤ (AND/OR)</strong></p>
            </div>

            <!-- –°–ø—Ä–∞–≤–∫–∞ -->
            <div class="help-section">
                <h3>üìò –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:</h3>
                <ul>
                    <li><strong>1. –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ</strong> —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ (txt, pdf)</li>
                    <li><strong>2. –ù–∞–∂–º–∏—Ç–µ "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É"</strong> - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã</li>
                    <li><strong>3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</strong> –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å</li>
                    <li><strong>4. –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä:</strong> AND (–≤—Å–µ —Å–ª–æ–≤–∞) –∏–ª–∏ OR (–ª—é–±–æ–µ —Å–ª–æ–≤–æ)</li>
                    <li><strong>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:</strong> .txt, .pdf (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)</li>
                    <li><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> –§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —á–∏—Ç–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ</li>
                </ul>
            </div>

        </main>

    </div>

    <!-- –î–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –ø–∞–ø–∫–∏ (—Å–∫—Ä—ã—Ç—ã–π) -->
    <input type="file" id="folderPicker" webkitdirectory directory multiple style="display: none;">

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const folderPathInput = document.getElementById('folderPath');
            const browseBtn = document.getElementById('browseBtn');
            const processFolderBtn = document.getElementById('processFolderBtn');
            const folderPicker = document.getElementById('folderPicker');
            const folderInfo = document.getElementById('folderInfo');
            const folderMessage = document.getElementById('folderMessage');
            const recursiveScan = document.getElementById('recursiveScan');
            const includePdf = document.getElementById('includePdf');

            const totalFilesEl = document.getElementById('totalFiles');
            const processedFilesEl = document.getElementById('processedFiles');
            const fileTypesEl = document.getElementById('fileTypes');

            const aiRecommendations = document.getElementById('aiRecommendations');
            const aiQueries = document.getElementById('aiQueries');
            const aiLoading = document.getElementById('aiLoading');

            const docCountElement = document.getElementById('docCount');
            const indexTermsElement = document.getElementById('indexTerms');
            const currentFolderElement = document.getElementById('currentFolder');
            const searchQueryInput = document.getElementById('searchQuery');

            let selectedFolderPath = '';

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ
            function loadSystemInfo() {
                fetch('/api/system/info')
                    .then(response => response.json())
                    .then(data => {
                        docCountElement.textContent = data.documents_count;
                        indexTermsElement.textContent = data.indexed_terms;

                        if (data.current_folder) {
                            currentFolderElement.textContent = data.current_folder;
                        }
                    })
                    .catch(error => {
                        console.error('Error loading system info:', error);
                    });
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadSystemInfo();

            // –ö–Ω–æ–ø–∫–∞ "–û–±–∑–æ—Ä..."
            browseBtn.addEventListener('click', function() {
                folderPicker.click();
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–∞–ø–∫–∏ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥
            folderPicker.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞
                    const firstFile = e.target.files[0];
                    if (firstFile.webkitRelativePath) {
                        const pathParts = firstFile.webkitRelativePath.split('/');
                        if (pathParts.length > 1) {
                            // –°–æ–±–∏—Ä–∞–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ
                            selectedFolderPath = pathParts[0];
                            folderPathInput.value = selectedFolderPath;
                            showFolderMessage('–ü–∞–ø–∫–∞ –≤—ã–±—Ä–∞–Ω–∞: ' + selectedFolderPath, 'info');
                        }
                    }
                }
            });

            // –†—É—á–Ω–æ–π –≤–≤–æ–¥ –ø—É—Ç–∏
            folderPathInput.addEventListener('input', function() {
                selectedFolderPath = this.value.trim();
            });

            // –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø–∞–ø–∫–∏
            document.querySelectorAll('.example-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const path = this.getAttribute('data-path');
                    folderPathInput.value = path;
                    selectedFolderPath = path;
                    showFolderMessage('–£–∫–∞–∑–∞–Ω –ø—É—Ç—å: ' + path, 'info');
                });
            });

            // –ö–Ω–æ–ø–∫–∞ "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É"
            processFolderBtn.addEventListener('click', async function() {
                if (!selectedFolderPath || selectedFolderPath.trim() === '') {
                    showFolderMessage('–£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ', 'error');
                    return;
                }

                showFolderMessage('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏...', 'loading');
                folderInfo.classList.add('hidden');

                try {
                    const response = await fetch('/api/scan_folder', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            folder_path: selectedFolderPath,
                            recursive: recursiveScan.checked,
                            include_pdf: includePdf.checked
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        totalFilesEl.textContent = data.stats.total_files;
                        processedFilesEl.textContent = data.stats.processed_files;
                        fileTypesEl.textContent = data.stats.file_types.join(', ');

                        folderInfo.classList.remove('hidden');
                        showFolderMessage(`‚úÖ –ü—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: ${data.stats.processed_files} —Ñ–∞–π–ª–æ–≤`, 'success');

                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ
                        loadSystemInfo();

                        // –ü–æ–ª—É—á–∞–µ–º AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                        getAIRecommendations(selectedFolderPath);

                    } else {
                        showFolderMessage('‚ùå –û—à–∏–±–∫–∞: ' + data.error, 'error');
                    }
                } catch (error) {
                    showFolderMessage('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞
            addAIResetButton();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å AI –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            checkAIStatus();

            // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
            async function getAIRecommendations(folderPath) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å AI
                try {
                    const statusResponse = await fetch('/api/ai/status');
                    const statusData = await statusResponse.json();

                    if (statusData.processing && statusData.seconds_since_last < 30) {
                        showFolderMessage('AI —É–∂–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã. –ü–æ–¥–æ–∂–¥–∏—Ç–µ...', 'info');
                        return;
                    }
                } catch (error) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å AI:', error);
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                aiLoading.classList.remove('hidden');
                aiRecommendations.classList.add('hidden');
                aiQueries.innerHTML = '';

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è
                const loadingTimeout = setTimeout(() => {
                    if (!aiLoading.classList.contains('hidden')) {
                        aiLoading.classList.add('hidden');
                        showFolderMessage('AI –∞–Ω–∞–ª–∏–∑ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º –æ–∂–∏–¥–∞–ª–æ—Å—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'info');
                    }
                }, 15000); // 15 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç

                try {
                    const response = await fetch('/api/ai/recommend', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            folder_path: folderPath
                        })
                    });

                    const data = await response.json();

                    clearTimeout(loadingTimeout); // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–∞—É—Ç

                    if (data.success && data.recommendations && data.recommendations.length > 0) {
                        displayAIRecommendations(data.recommendations);
                        aiRecommendations.classList.remove('hidden');
                        showFolderMessage('‚úÖ AI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã!', 'success');
                    } else {
                        // –ï—Å–ª–∏ AI –Ω–µ —Å–º–æ–≥, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–ø–∞—Å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                        displayAIRecommendations([
                            "machine learning",
                            "data analysis",
                            "artificial intelligence",
                            "computer science",
                            "programming"
                        ]);
                        aiRecommendations.classList.remove('hidden');
                        showFolderMessage('AI –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –±–∞–∑–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', 'info');
                    }
                } catch (error) {
                    clearTimeout(loadingTimeout);
                    console.error('AI recommendation error:', error);

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–ø–∞—Å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    displayAIRecommendations([
                        "machine learning",
                        "data analysis",
                        "artificial intelligence",
                        "computer science",
                        "information technology"
                    ]);
                    aiRecommendations.classList.remove('hidden');
                    showFolderMessage('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', 'info');
                } finally {
                    clearTimeout(loadingTimeout);
                    aiLoading.classList.add('hidden');
                }
            }

            function validateAIRecommendations(recommendations) {
                return recommendations.filter(rec => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
                    const hasOperators = /\b(AND|OR|NOT)\b/i.test(rec);
                    const hasBrackets = /[()\[\]{}]/.test(rec);
                    const hasQuotes = /["']/.test(rec);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
                    const wordCount = rec.split(/\s+/).length;
                    const isValidLength = wordCount >= 1 && wordCount <= 4;

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç
                    const isEnglish = /^[a-z\s]+$/i.test(rec.replace(/[^a-z\s]/gi, ''));

                    return !hasOperators && !hasBrackets && !hasQuotes && isValidLength && isEnglish;
                });
            }

            function displayAIRecommendations(recommendations) {
                aiQueries.innerHTML = '';

                // –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                const validRecommendations = validateAIRecommendations(recommendations);

                // –ï—Å–ª–∏ –≤—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–ø–∞—Å–Ω—ã–µ
                const finalRecommendations = validRecommendations.length > 0
                    ? validRecommendations
                    : [
                        "machine learning",
                        "data analysis",
                        "artificial intelligence",
                        "computer science",
                        "programming"
                    ];

                finalRecommendations.forEach((query, index) => {
                    const queryButton = document.createElement('button');
                    queryButton.className = 'ai-query-btn';
                    queryButton.innerHTML = `
                        <span class="ai-query-number">${index + 1}</span>
                        <span class="ai-query-text">${query}</span>
                    `;
                    queryButton.title = `–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–æ–∏—Å–∫–∞: ${query}`;

                    queryButton.addEventListener('click', function() {
                        // –í—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                        searchQueryInput.value = query;
                        // –í—ã–±–∏—Ä–∞–µ–º AND –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        document.querySelector('input[name="operator"][value="AND"]').checked = true;
                        searchQueryInput.focus();

                        // –ê–Ω–∏–º–∞—Ü–∏—è
                        queryButton.classList.add('clicked');
                        setTimeout(() => {
                            queryButton.classList.remove('clicked');
                        }, 300);
                    });

                    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                    setTimeout(() => {
                        queryButton.style.opacity = '1';
                        queryButton.style.transform = 'translateY(0)';
                    }, index * 100);

                    aiQueries.appendChild(queryButton);
                });
            }

            function addAIResetButton() {
                const resetBtn = document.createElement('button');
                resetBtn.id = 'aiResetBtn';
                resetBtn.className = 'ai-reset-btn hidden';
                resetBtn.textContent = 'üîÑ –°–±—Ä–æ—Å–∏—Ç—å AI';
                resetBtn.title = '–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å AI –∞–Ω–∞–ª–∏–∑–∞';

                resetBtn.addEventListener('click', async function() {
                    try {
                        await fetch('/api/ai/status', {
                            method: 'DELETE'
                        });
                        showFolderMessage('–°—Ç–∞—Ç—É—Å AI —Å–±—Ä–æ—à–µ–Ω', 'success');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ AI:', error);
                    }
                });

                document.querySelector('.ai-recommendations').appendChild(resetBtn);
            }

            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
            function displayAIRecommendations(recommendations) {
                aiQueries.innerHTML = '';

                recommendations.forEach((query, index) => {
                    const queryButton = document.createElement('button');
                    queryButton.className = 'ai-query-btn';
                    queryButton.innerHTML = `
                        <span class="ai-query-number">${index + 1}</span>
                        <span class="ai-query-text">${query}</span>
                    `;
                    queryButton.title = `–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–æ–∏—Å–∫–∞: ${query}`;

                    queryButton.addEventListener('click', function() {
                        // –í—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                        searchQueryInput.value = query;
                        // –í—ã–±–∏—Ä–∞–µ–º AND –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        document.querySelector('input[name="operator"][value="AND"]').checked = true;
                        searchQueryInput.focus();

                        // –ê–Ω–∏–º–∞—Ü–∏—è
                        queryButton.classList.add('clicked');
                        setTimeout(() => {
                            queryButton.classList.remove('clicked');
                        }, 300);
                    });

                    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                    setTimeout(() => {
                        queryButton.style.opacity = '1';
                        queryButton.style.transform = 'translateY(0)';
                    }, index * 100);

                    aiQueries.appendChild(queryButton);
                });
            }

            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
            function showFolderMessage(message, type) {
                folderMessage.textContent = message;
                folderMessage.className = 'folder-message';

                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–ª–∞—Å—Å—ã
                folderMessage.classList.remove('success', 'error', 'info', 'loading');

                if (type) {
                    folderMessage.classList.add(type);
                }

                folderMessage.classList.remove('hidden');

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                if (type !== 'loading') {
                    setTimeout(() => {
                        folderMessage.classList.add('hidden');
                    }, 5000);
                }
            }

            // –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (—É–∂–µ –≤ —Ñ–æ—Ä–º–µ)
            // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
            searchQueryInput.addEventListener('focus', function() {
                if (!this.value) {
                    this.placeholder = '–ü—Ä–∏–º–µ—Ä—ã: "machine learning", "data AND analysis", "python OR java"';
                }
            });

            searchQueryInput.addEventListener('blur', function() {
                this.placeholder = '–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º...';
            });

            // Drag & Drop –¥–ª—è –ø—É—Ç–∏
            folderPathInput.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });

            folderPathInput.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });

            folderPathInput.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');

                // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –ø–µ—Ä–µ—Ç–∞—â–µ–Ω–Ω–æ–π –ø–∞–ø–∫–µ (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö)
                if (e.dataTransfer.items) {
                    for (let i = 0; i < e.dataTransfer.items.length; i++) {
                        if (e.dataTransfer.items[i].kind === 'file') {
                            const file = e.dataTransfer.items[i].getAsFile();
                            if (file && file.path) {
                                this.value = file.path;
                                selectedFolderPath = file.path;
                                showFolderMessage('–ü–µ—Ä–µ—Ç–∞—â–µ–Ω –ø—É—Ç—å: ' + file.path, 'info');
                                break;
                            }
                        }
                    }
                }
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
            if (parseInt(docCountElement.textContent) > 0) {
                setTimeout(() => {
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏
                    if (currentFolderElement.textContent !== '–ù–µ –≤—ã–±—Ä–∞–Ω–∞') {
                        getAIRecommendations(currentFolderElement.textContent);
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>